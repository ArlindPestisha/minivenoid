(this["webpackJsonpthree-react-test"]=this["webpackJsonpthree-react-test"]||[]).push([[0],{28:function(t,e,n){t.exports=n(37)},36:function(t,e,n){},37:function(t,e,n){"use strict";n.r(e);var a,o,r,i,c=n(22),u=n(3),s=n(2),m=n(0),l=n.n(m),f=n(23),h=n.n(f),d=n(5),b=n(13),v=n(17),p=l.a.createContext(),M=function(t){var e=t.zoom,n=t.position,a=t.children,o=l.a.useMemo((function(){return{zoom:e,position:n}}),[e,n]);return l.a.createElement(p.Provider,{value:o},a)},g=function(){return l.a.useContext(p)},j=n(18),O=function(t){return Math.exp(t)},E=function(t){document.documentElement.style.cursor=t||null},y=(a=120,o=200,r=10,i=4,new Float32Array([0,r,0,a,o-r,0,0,o-r,0,0,r,0,a,r,0,a,o-r,0].concat(Object(u.a)(new Array(i).fill(0).map((function(t,e,n){var c=e*Math.PI/(2*i),u=(e+1)*Math.PI/(2*i);return[r*(1-Math.cos(c)),r*(1-Math.sin(c)),0,r*(1-Math.cos(u)),r*(1-Math.sin(u)),0,a-r*(1-Math.cos(c)),r*(1-Math.sin(c)),0,r*(1-Math.cos(u)),r*(1-Math.sin(u)),0,a-r*(1-Math.cos(u)),r*(1-Math.sin(u)),0,a-r*(1-Math.cos(c)),r*(1-Math.sin(c)),0,r*(1-Math.cos(u)),o-r*(1-Math.sin(u)),0,r*(1-Math.cos(c)),o-r*(1-Math.sin(c)),0,a-r*(1-Math.cos(c)),o-r*(1-Math.sin(c)),0,a-r*(1-Math.cos(u)),o-r*(1-Math.sin(u)),0,r*(1-Math.cos(u)),o-r*(1-Math.sin(u)),0,a-r*(1-Math.cos(c)),o-r*(1-Math.sin(c)),0]})).flat())))),w=l.a.memo((function(t){var e=t.card,n=t.cardIndex,a=t.geometry,o=t.material,r=t.onMoveCard,i=g().zoom,c=Object(v.a)({onPointerEnter:function(t){t.buttons||E("grab")},onPointerLeave:function(t){var e=t.buttons;t.button;e||E()},onDragStart:function(){E("grabbing")},onDragEnd:function(){E("grab")},onDrag:function(t){var n=t.buttons,a=(t.active,Object(s.a)(t.movement,2)),o=a[0],c=a[1],u=t.memo;if(1===n){u||(u=e.position);var m=O(i.getValue());return r({id:e.id,position:[u[0]+o/m,u[1]-c/m]}),u}}},{pointerEvents:!0});return l.a.createElement("mesh",Object.assign({position:[].concat(Object(u.a)(e.position),[1e-10*n]),geometry:a,material:o},c()))})),z=function(t){var e=t.cards,n=Object(j.a)(t,["cards"]),a=Object(d.f)(),o=Object(s.a)(a,2),r=o[0],i=o[1],c=Object(d.f)(),u=Object(s.a)(c,2),m=u[0],f=u[1];return l.a.createElement(l.a.Fragment,null,l.a.createElement("bufferGeometry",{ref:r},l.a.createElement("bufferAttribute",{attachObject:["attributes","position"],count:y.length/3,array:y,itemSize:3})),l.a.createElement("meshBasicMaterial",{ref:m,color:"#222",opacity:.7}),i&&f&&e.map((function(t,e){return l.a.createElement(w,Object.assign({key:t.id,card:t,cardIndex:e,geometry:i,material:f},n))})))},P=l.a.memo((function(t){var e=t.fromPosition,n=t.toPosition,a=l.a.useRef(null),o=new Float32Array([].concat(Object(u.a)(e),[0],Object(u.a)(n),[0])),r=Object(d.h)((function(t){t.needsUpdate=!0}),[e,n]);return l.a.createElement("line",null,l.a.createElement("bufferGeometry",{ref:a,attach:"geometry"},l.a.createElement("bufferAttribute",{ref:r,attachObject:["attributes","position"],array:o,count:2,itemSize:3})),l.a.createElement("lineBasicMaterial",{attach:"material",color:"#333"}))})),x=function(t){var e=t.connections,n=t.cards;return l.a.createElement(l.a.Fragment,null,e.map((function(t){return l.a.createElement(P,{key:t.id,fromPosition:n.find((function(e){return e.id===t.from})).position,toPosition:n.find((function(e){return e.id===t.to})).position})})))},k=function(t){var e=t.makeDefault,n=void 0===e||e,a=Object(j.a)(t,["makeDefault"]),o=Object(d.g)(),r=o.setDefaultCamera,i=o.camera,c=o.size,u=g(),s=u.zoom,m=u.position,f=l.a.useRef(null);return Object(d.e)((function(){f.current.updateProjectionMatrix()})),l.a.useLayoutEffect((function(){if(n){var t=i;return r(f.current),function(){return r(t)}}}),[n,r]),l.a.createElement(b.a.orthographicCamera,Object.assign({ref:f,left:c.width/-2,right:c.width/2,top:c.height/2,bottom:c.height/-2,position:m.interpolate((function(t,e){return[t,-e,5]})),zoom:s.interpolate(O)},a))},C=(n(36),new URLSearchParams(window.location.search)),S=parseInt(C.get("amt"))||500,A=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=new Array(t).fill(void 0).map((function(){return{position:[(.5-Math.random())*Math.sqrt(t)*500,(.5-Math.random())*Math.sqrt(t)*400],id:Math.random().toString()}})),a=new Array(e).fill(0).map((function(){var t=Math.max(0,Math.floor(Math.random()*n.length-1));return{id:Math.random().toString(),from:n[t].id,to:n[t+1].id}}));return{cards:n,connections:a}}();h.a.render(l.a.createElement((function(){var t=l.a.useRef(null),e=l.a.useState(A.cards),n=Object(s.a)(e,2),a=n[0],o=n[1],r=l.a.useState(A.connections),i=Object(s.a)(r,2),m=i[0],f=(i[1],Object(b.b)((function(){return{zoom:0}}))),h=Object(s.a)(f,2),p=h[0].zoom,g=h[1],j=Object(b.b)((function(){return{position:[0,0]}})),E=Object(s.a)(j,2),y=E[0].position,w=E[1],P=Object(v.a)({onWheel:function(t){var e=t.event,n=t.movement,a=t.memo,o=t.active;if(e){var r=0===e.deltaMode?1:50;a||(a=y.getValue());var i=O(p.getValue());return w({position:n.map((function(t,e){return t/i*r+a[e]})),immediate:o}),a}},onPinch:function(t){var e=Object(s.a)(t.da,1)[0];g({zoom:e/50})},onDrag:function(t){var e=t.buttons,n=t.active,a=t.movement,o=t.direction,r=t.velocity,i=t.memo;if(4===e){i||(i=y.getValue());var c=O(p.getValue());return w({position:a.map((function(t,e){return t*c+i[e]})),immediate:n,config:{velocity:o.map((function(t){return t*r}))}}),i}}},{domTarget:t,event:{passive:!1}});l.a.useEffect(P,[P]);var C=l.a.useCallback((function(t,e){o((function(n){var a=n.findIndex((function(e){return e.id===t}));return[].concat(Object(u.a)(n.slice(0,a)),[e(n[a])],Object(u.a)(n.slice(a+1)))}))}),[]),S=l.a.useCallback((function(t){var e=t.id,n=t.position;C(e,(function(t){return Object(c.a)({},t,{position:n})}))}),[C]);return l.a.createElement("div",{ref:t},l.a.createElement(d.a,null,l.a.createElement(M,{zoom:p,position:y},l.a.createElement(k,null),l.a.createElement(x,{cards:a,connections:m}),l.a.createElement(z,{cards:a,onMoveCard:S}))))}),null),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.9d54126f.chunk.js.map